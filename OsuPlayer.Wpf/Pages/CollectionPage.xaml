<Page x:Class="Milkitic.OsuPlayer.Pages.CollectionPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:osuPlayer="clr-namespace:Milkitic.OsuPlayer"
      xmlns:data="clr-namespace:Milkitic.OsuPlayer.Data"
      xmlns:cvt="clr-namespace:Milkitic.OsuPlayer.Converter"
      mc:Ignorable="d" 
      d:DesignHeight="450" d:DesignWidth="800"
      Title="CollectionPage" Unloaded="Page_Unloaded" IsHitTestVisible="True" Focusable="False">
    <Page.Resources>
        <cvt:DateTimeConverter x:Key="CvtDate"/>
    </Page.Resources>
    <Grid>
        <TabControl Background="Transparent" BorderThickness="0">
            <TabItem Style="{StaticResource PinkTabItem}">
                <TabItem.Header>
                    <TextBlock Text="我的收藏" Cursor="Hand" FontSize="16" Padding="18,10"/>
                </TabItem.Header>
                <Grid Margin="0,10,0,0">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition/>
                    </Grid.RowDefinitions>
                    <Grid x:Name="CollectionInfo">
                        <Grid.DataContext>
                            <data:Collection />
                        </Grid.DataContext>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="auto"/>
                            <ColumnDefinition/>
                            <ColumnDefinition Width="auto"/>
                        </Grid.ColumnDefinitions>
                        <Grid Width="150" Height="150" Margin="10">
                            <Image x:Name="CollectionThumb" RenderOptions.BitmapScalingMode="HighQuality"
                                   Source="{Binding Path=ImagePath}" Stretch="UniformToFill"
                                   HorizontalAlignment="Center" VerticalAlignment="Center" />
                        </Grid>
                        <StackPanel Grid.Column="1" Margin="10">
                            <StackPanel Orientation="Horizontal">
                                <Label x:Name="LblTitle" FontSize="22" Content="{Binding Path=Name}" VerticalAlignment="Center" />
                                <Button Content="编辑信息" Width="70" Margin="5" Height="30" Style="{StaticResource CollectionButtonStyle}" />
                                <Button x:Name="BtnDelCol" Content="删除收藏" Width="70" Margin="5" Height="30"  Style="{StaticResource CollectionButtonStyle}" Click="BtnDelCol_Click"/>
                            </StackPanel>
                            <StackPanel Orientation="Horizontal">
                                <Label Content="创建时间："/>
                                <Label Content="{Binding Path=CreateTime, Converter={StaticResource CvtDate}}"/>
                            </StackPanel>
                            <StackPanel Orientation="Horizontal">
                                <Button Content="播放全部" Width="70" Margin="5" Height="30" Style="{StaticResource Collection2ButtonStyle}"/>
                                <Button x:Name="BtnExportAll" Content="导出全部" Width="70" Margin="5" Height="30" Style="{StaticResource Collection2ButtonStyle}" Click="BtnExportAll_Click" />
                            </StackPanel>
                            <StackPanel Orientation="Horizontal">
                                <Label Content="简介："></Label>
                                <Label x:Name="LblDescription" Content="{Binding Path=Description}">
                                    <Label.Style>
                                        <Style TargetType="{x:Type Label}">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding Path=Description}" Value="">
                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding Path=Description}" Value="{x:Null}">
                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Label.Style>
                                </Label>
                                <Label x:Name="LblAdd" Content="添加简介">
                                    <Label.Style>
                                        <Style TargetType="{x:Type Label}">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding Path=Description}" Value="">
                                                    <Setter Property="Visibility" Value="Visible"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding Path=Description}" Value="{x:Null}">
                                                    <Setter Property="Visibility" Value="Visible"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Label.Style>
                                </Label>
                            </StackPanel>
                        </StackPanel>
                        <StackPanel Grid.Column="2" Margin="10 10 20 10" >
                            <Label Content="歌曲数" HorizontalAlignment="Right"/>
                            <Label x:Name="ListCount" Content="0" HorizontalAlignment="Right" FontWeight="Bold" Margin="0 -5 0 0"/>
                        </StackPanel>

                    </Grid>

                    <ListView Grid.Row="1" x:Name="MapList" Margin="0,30,0,2" Background="#40FFFFFF" BorderThickness="0"
                  ItemsSource="{Binding Mode=OneWay}" MouseDoubleClick="RecentList_MouseDoubleClick"
                  ItemContainerStyle="{StaticResource GridView}">
                        <ListView.ContextMenu>
                            <ContextMenu Style="{StaticResource DefaultContextMenu}">
                                <MenuItem x:Name="ItemPlay" Header="播放" Click="ItemPlay_Click" Style="{DynamicResource DefaultMenuItem}"  />
                                <Separator/>
                                <MenuItem x:Name="ItemCollect" Header="收藏..." Click="ItemCollect_Click" Style="{DynamicResource DefaultMenuItem}"  />
                                <MenuItem x:Name="ItemExport" Header="导出" Click="ItemExport_Click" Style="{DynamicResource DefaultMenuItem}"  />
                                <Separator/>
                                <MenuItem x:Name="ItemSearchTitle" Header="搜索该标题" Click="ItemSearchTitle_Click"  Style="{DynamicResource DefaultMenuItem}" />
                                <MenuItem x:Name="ItemSearchArtist" Header="搜索该艺术家" Click="ItemSearchArtist_Click" Style="{DynamicResource DefaultMenuItem}"  />
                                <MenuItem x:Name="ItemSearchSource" Header="搜索该来源" Click="ItemSearchSource_Click"  Style="{DynamicResource DefaultMenuItem}" />
                                <MenuItem x:Name="ItemSearchMapper" Header="搜索该作者" Click="ItemSearchMapper_Click" Style="{DynamicResource DefaultMenuItem}"  />
                                <Separator/>
                                <MenuItem x:Name="ItemDelete" Header="从收藏夹中移除" Click="ItemDelete_Click"  Style="{DynamicResource DefaultMenuItem}" />
                                <Separator/>
                                <MenuItem x:Name="ItemSet" Header="打开成绩页" Click="ItemSet_Click"  Style="{DynamicResource DefaultMenuItem}" />
                                <MenuItem x:Name="ItemFolder" Header="打开所在目录" Click="ItemFolder_Click"  Style="{DynamicResource DefaultMenuItem}" />
                            </ContextMenu>
                        </ListView.ContextMenu>
                        <ListView.DataContext>
                            <osuPlayer:BeatmapViewModel/>
                        </ListView.DataContext>
                        <ListView.Resources>
                            <DataTemplate x:Key="IdDt">
                                <Label VerticalAlignment="Center" Margin="0,7,0,7"
                                       Content="{Binding Id, Mode=OneWay}" Foreground="#FF9C9C9C" />
                            </DataTemplate>
                            <DataTemplate x:Key="TitleDt">
                                <Label VerticalAlignment="Center" Content="{Binding AutoTitle, Mode=OneWay}"/>
                            </DataTemplate>
                            <DataTemplate x:Key="ArtistDt">
                                <Label VerticalAlignment="Center" Content="{Binding AutoArtist, Mode=OneWay}" Foreground="#FF9C9C9C"/>
                            </DataTemplate>
                            <DataTemplate x:Key="CreatorDt">
                                <Label VerticalAlignment="Center" Content="{Binding AutoCreator, Mode=OneWay}" />
                            </DataTemplate>
                            <DataTemplate x:Key="VersionDt">
                                <Label VerticalAlignment="Center" Content="{Binding AutoVersion}" Foreground="#FF9C9C9C" />
                            </DataTemplate>
                        </ListView.Resources>
                        <ListView.View>
                            <GridView ColumnHeaderContainerStyle="{StaticResource MyHeaderStyle}">
                                <GridViewColumn Width="40" CellTemplate="{StaticResource IdDt}"/>
                                <GridViewColumn Header="标题" Width="300" CellTemplate="{StaticResource TitleDt}"/>
                                <GridViewColumn Header="艺术家" Width="200" CellTemplate="{StaticResource ArtistDt}"/>
                                <GridViewColumn Header="作者" Width="100" CellTemplate="{StaticResource CreatorDt}" />
                                <GridViewColumn Header="难度" Width="150" CellTemplate="{StaticResource VersionDt}" />
                            </GridView>
                        </ListView.View>
                    </ListView>
                </Grid>
            </TabItem>
        </TabControl>

    </Grid>
</Page>
